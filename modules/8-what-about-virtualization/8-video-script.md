Hello and welcome to this video for module 8 of the NetBox Zero to Hero training course. If you haven't already checked out the earlier modules yet then you can find the link to them in the notes below to get started. 

For this demo I am using a docker instance of NetBox running locally on my laptop. If you would like to follow along with the demo, then you can easily do that. There are a couple of links down below to help you spin up your own instance of NetBox, along with a link to the course that accompanies this video. 

The IT Manager has now decided that as there are going to be two data scientists working out of the new Brisbane office, it makes sense to have a Database server located on premises there, along with a local file and print server. These servers will be virtual machines hosted on a VMware vSphere cluster.

In this video, Network Engineer Susan will add the required physical servers for the vSphere cluster, create the cluster and add the Virtual Machines for the servers. She will also define the services including the protocol and port numbers that will be running on the VM servers, and all of this will be done via the web interface.

So, the first thing to do is to add the physical servers that will make up the VMware vSphere cluster. As you'll know if you've been following along, before you can add a device you need to set up the manufacturer and the device type. So under devices, click add next to manufacturers and then enter HPE and click create. Then create the device role for the servers - click the plus next to device roles and then add vSphere, and go with orange for the colour, and click create. 

Then add the device type. and do this by importing from the device type library - so from the github repo (https://github.com/netbox-community/devicetype-library/blob/master/device-types/HPE/ProLiant_DL380_Gen9.yaml) copy the yaml definition of the HPE ProLiant DL380 Gen9 server and then in the UI, click on the blue import icon next to device types, and then paste in the yaml and click submit. 

Next create 2 devices from this device type, by clicking on the blue import icon next to devices, and then paste in the CSV data to define the 2 servers AUBRI01-VSP-1 and 2. Note that the csv data also includes the rack mounting information - with the first server located at rack unit 1, and the second at unit 3. so after clicking on submit, check the rack elevation now by clicking on the link to the rack - and there are the 2 new servers at the bottom of the rack. 

Next add the cables to connect the servers to the access switch - and again do this using the CSV data from the file accompanying this module. click on connections, and then the blue import icon, and paste in the csv data for the 6 cables. These are connecting the iLO ports and 2 of the gigabit ethernet ports, and are 2 metre long, cat 6 cables, in blue for iLO and green for the main ethernet connections - then click submit. 

great, so the 2 ethernet interfaces on each server are going to be members of a LAG interfaces, or Aggregated Ethernet interface in Juniper networking terms. in order to create these LAG interfaces, click devices, select the switch, then click interfaces, then scroll down and click on add interfaces in the bottom right corner. so the name of the first LAG interface is ae0, it is of type LAG, the 802.1Q Mode mode is tagged all, and the VLAN groups is Brisbane vlans. then add the 2nd one ae1. 

next select both interfaces ge-0/0/1 and 2, and click edit, then add them both to the the ae0 LAG interface, by scrolling down to Related Interfaces, and for LAG select ae0, then under 802.1Q Switching select tagged all, and Brisbane vlans, then click on apply. 

then do the same for the interfaces ge-0/0/3 and 4, and but this time select ae1 for the LAG. Then for the 2 ports connected to the iLO ports on select both ge-0/0/44 and 45, then for 802.1Q Switching select mode access, and then the Brisbane vlan group, and select the network management vlan 50 - and then click apply. 

the last thing to do for the physical servers is assign IP addresses to the iLO interfaces. to do this got to IPAM, prefixes and then select the Network Management prefix, and click the IP addresses tab - then click add IP address. note that the next available IP address is already pre-populated, set the status as reserved, then add the DNS name of the first server AUBRI01-VSP-1, then under interface assignment, click device, select the server and iLO interface, and tick the box to make this the primary IP as this is the out of band management port.  then click create and add another, edit the dns name to be server 2, and assign it to the 2nd servers iLO port, click make primary and then click save. 

OK, so that's the physical server and connections all added, it's time to set up the virtual cluster and the VM's themselves. Before this though we need to add the platforms for the VM servers - so under devices click platforms and then add - now the database server is running on ubuntu linux version 22.10, add that as the name and click on create and add another. and the file and print server is running on Windows Server 2022, so add this and then refresh the slug, anf click create. great so that's the platforms all set up, obviously these can be used for any other servers that are added to the network going forward.

click on virtualization and click the plus next to cluster types - give it a name of VMware vSphere. and click create. then click add cluster and give it the name AUBRI01-VSPHERE-1, status is planned, select the Brisbane site and the consulting tenant and click create. then assign the 2 physical servers to the cluster by clicking assign device and then select the region as brisbane, the site group as branch, select the rack and select both of the physical vsphere servers - and then click create   

OK, now to add the VMs, just click add virtual machine and the first one to add is the database server - SQL-01, status is planned, the cluster is already populated, so select the platform as ubuntu 22.10, and then assign the resources - so this one has 32 vcpu's, 128 gig or RAM and 20 GB of disk. then click create and add another - this is the windows file and print server - so the platform is windows server 2022 and has 8 vcpu's, 64 gig of ram and 128 gb of disk. 

so now we have the VM's we need to create their VM interfaces - click on the database server and click add interfaces - give it a name of eth0 and for switching make it tagged for vlan 10. then do the same for the windows server - click the server name and then click add interfaces - then call this one ethernet - and again for switching make it tagged for vlan 10 and click create. 

so now that there are VM interfaces we can assign them IP addresses from the data vlan - so go to IPAM, prefixes - and click the data vlan and then the IP addresses tab - then click add IP address, so this is reserved, add the dns name of the database server, then for interface Assignment click virtual machine, select the VM and interface and make it primary. 

then click create and add another - this time time DNS name is the windows server 'AUBRI01-WIN-01' select then VM and interface ethernet and again make it primary, and click create. Great! so that's the VM's created with interfaces and IP addresses. 

Now lets make use of another great feature within netbox called service mapping and this is where you can define the actual services for applications that run on servers - so within IPAM, click the + sign next to service templates - and call this one PostgreSQL and define the protocol as TCP and the port number as 5432, then click create and add another. and this one will be SSH, again tcp port 22. then add another this time for the windows server it will be tcp port 139 and 445 and then click create. 

so now go back to virtualization, virtual machines, and select the database server, then assign the the services to it from the templates you just created - click on assign service - and then select the postgres service template, select the IP address (which in this case is the only IP defined for the vm interface) and create and add another, select the database server again under virtual machine, and this time add the ssh service from the template, and the IP address. 

Then lastly click create and add another - and for the VM select the windows server, then windows file and print service from the template, the IP of the VM interface and click create and thats all 3 of the services created and assigned to the VM's.  OK so now you check the finished VM's - for example the windows VM and you can see the services now defined also. 

One last thing that would be really useful here also is for Susan to add the contacts for these servers so other team members know who to contact whenever there is any planned planned work like upgrades etc for the servers - so she can click add contact - select the IT group and then add Eric as the primary contact for the operations role for this server. and just for completeness do the same for the SQL server to add Eric again as the contact. 

Now, if you are following along with the course and have netbox set up as your dynamic inventory for Ansible - then if you check the inventory again now with the command 'ansible-inventory --list -i netbox_inv.yml' and then scroll back up through the output. you can see that the new hosts have been automatically added to the inventory - for example here is the SQL server with all it's host variables - so if you are using Ansible to automate your servers as well as network devices then this is awesome as they will be in your inventory just like any other device you have defined!

So, I hope that has been a useful overview of how NetBox models Virtualization, including Cluster Types, Clusters, Platforms, VM's, VM Interfaces and application services! 

If you have any questions as you go through the course then pop on over to the NetBox Zero to Hero channel on the NetDev Community Slack! If you aren't already a member then you can sign up for free using the link below.

So, once again, thanks very much for watching!